#!/bin/bash

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <mysql_password>"
    exit 1
fi

# Variables
MYSQL_PASSWORD="$1"
DATE=$(date +"%d-%m-%Y")
BACKUP_FILE="backup.sql"
ARCHIVE_FILE="${DATE}.tar.gz"

# Generate MySQL dump
mysqldump -u root -p"${MYSQL_PASSWORD}" --all-databases > "${BACKUP_FILE}"
if [ $? -ne 0 ]; then
    echo "MySQL dump failed"
    exit 1
fi

# Compress the dump file
tar -czf "${ARCHIVE_FILE}" "${BACKUP_FILE}"
if [ $? -ne 0 ]; then
    echo "Compression failed"
    exit 1
fi

# Clean up the dump file
rm "${BACKUP_FILE}"

echo "Backup and compression successful. Archive file: ${ARCHIVE_FILE}"
